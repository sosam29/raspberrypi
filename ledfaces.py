import RPi.GPIO as GPIO
import time
#import threading
# no display
# wiring needs to be checked
# main suspect is the IC 74HC595

LSBFIRST =1
MSBFIRST = 2

dataPin= 11
latchPin = 13
clockPin = 15
pic =[0x1c, 0x22, 0x51, 0x45, 0x45, 0x51, 0x22, 0x1c] # simily face data
#num =(0xc0, 0xf9, 0xa4, 0xb0, 0x99, 0x92, 0x82, 0xf8, 0x80, 0x90)
data =[
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # ''
    0x00, 0x00, 0x3f, 0x41, 0x41, 0x3E, 0x00, 0x00, # 0
    0x00, 0x00, 0x21, 0x7f, 0x01, 0x00, 0x00, 0x00, # 1
    0x00, 0x00, 0x23, 0x45, 0x49, 0x31, 0x00, 0x00, # 2
    0x00, 0x00, 0x22, 0x49, 0x49, 0x36, 0x00, 0x00, # 3
    0x00, 0x00, 0x0E, 0x32, 0x7f, 0x02, 0x00, 0x00, # 4
    0x00, 0x00, 0x79, 0x49, 0x49, 0x46, 0x00, 0x00, # 5
    0x00, 0x00, 0x3e, 0x49, 0x49, 0x26, 0x00, 0x00, # 6
    0x00, 0x00, 0x60, 0x47, 0x48, 0x70, 0x00, 0x00, # 7
    0x00, 0x00, 0x36, 0x49, 0x49, 0x36, 0x00, 0x00, # 8
    0x00, 0x00, 0x32, 0x49, 0x49, 0x3e, 0x00, 0x00, # 9
    0x00, 0x00, 0x3f, 0x44, 0x44, 0x3f, 0x00, 0x00, # A
    0x00, 0x00, 0x7f, 0x49, 0x49, 0x36, 0x00, 0x00, # B
    0x00, 0x00, 0x3E, 0x41, 0x41, 0x22, 0x00, 0x00, # C
    0x00, 0x00, 0x7f, 0x41, 0x41, 0x3e, 0x00, 0x00, # D
    0x00, 0x00, 0x7f, 0x49, 0x49, 0x41, 0x00, 0x00, # E
    0x00, 0x00, 0x7f, 0x48, 0x48, 0x40, 0x00, 0x00, # F
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, # ''
    ]




def setup():
    GPIO.setmode(GPIO.BOARD)
    GPIO.setup(dataPin, GPIO.OUT)
    GPIO.setup(latchPin, GPIO.OUT)
    GPIO.setup(clockPin, GPIO.OUT)
    
    
def shiftOut(dPin, cPin, order, val):
    for i in range(0, 8):
        GPIO.output(cPin, GPIO.LOW)
        if(order == LSBFIRST):
            print("LSBFIRST shiftout")
            GPIO.output(dPin, (0x01 & (val >> i)==0x01) and GPIO.HIGH or GPIO.LOW)
        elif(order == MSBFIRST):
            print("MSBFIRST shiftout")
            GPIO.output(dPin, (0x01 & (val << i) ==0x08) and GPIO.HIGH or GPIO.LOW)
                        
        GPIO.output(cPin, GPIO.HIGH)


def loop():
    while True:
        for j in range(0, 500):
            x= 0x08
            for i in range(0,8):
                print("i: %d j: %d" %(i, j))
                GPIO.output(latchPin, GPIO.LOW)
                shiftOut(dataPin, clockPin, MSBFIRST, pic[i])
                shiftOut(dataPin, clockPin, MSBFIRST, ~x)
                GPIO.output(latchPin, GPIO.HIGH)
                time.sleep(1)
                print("right shifting by 1")
                x>>1
            for k in range(0, len(data)-8):
                for j in range(0, 20):
                    x = 0x80
                    for i in range(k, k+8):
                        GPIO.output(latchPin, GPIO.LOW)
                        shiftOut(dataPin, clockPin, MSBFIRST, data[i])
                        shiftOut(dataPin, clockPin, MSBFIRST, ~x)
                        GPIO.output(latchPin, GPIO.HIGH)
                        time.sleep(1)
                        x >> 1
                 
                        
def destroy():
    
    GPIO.cleanup()

    
if __name__=="__main__":
    setup()
    try:
        loop()
    except KeyboardInterrupt:
        destroy()
        
    
    